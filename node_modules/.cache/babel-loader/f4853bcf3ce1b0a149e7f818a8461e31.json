{"ast":null,"code":"import \"source-map-support/register\";\nimport stripePackage from \"stripe\";\nimport { calculateCost } from \"./libs/billing-lib\";\nimport { success, failure } from \"./libs/response-lib\";\nexport async function main(event, context) {\n  /*The storage variable is the number of notes the user would like to store\n  in his account. And source is the Stripe token for the card that we \n  are going to charge.*/\n  const {\n    storage,\n    source\n  } = JSON.parse(event.body);\n  const amount = calculateCost(storage);\n  const description = \"Scratch charge\"; // Load our secret key from the environment variables\n\n  const stripe = stripePackage(process.env.stripeSecretKey);\n\n  try {\n    await stripe.charges.create({\n      source,\n      amount,\n      description,\n      currency: \"usd\"\n    });\n    return success({\n      status: true\n    });\n  } catch (e) {\n    return failure({\n      message: e.message\n    });\n  }\n}","map":{"version":3,"sources":["/home/robert/Projects/budget/billing.js"],"names":["stripePackage","calculateCost","success","failure","main","event","context","storage","source","JSON","parse","body","amount","description","stripe","process","env","stripeSecretKey","charges","create","currency","status","e","message"],"mappings":";AAAA,OAAOA,aAAP,MAA0B,QAA1B;AACA,SAASC,aAAT,QAA8B,oBAA9B;AACA,SAASC,OAAT,EAAkBC,OAAlB,QAAiC,qBAAjC;AAEA,OAAO,eAAeC,IAAf,CAAoBC,KAApB,EAA2BC,OAA3B,EAAoC;AAE1C;;;AAIA,QAAM;AAAEC,IAAAA,OAAF;AAAWC,IAAAA;AAAX,MAAsBC,IAAI,CAACC,KAAL,CAAWL,KAAK,CAACM,IAAjB,CAA5B;AACA,QAAMC,MAAM,GAAGX,aAAa,CAACM,OAAD,CAA5B;AACA,QAAMM,WAAW,GAAG,gBAApB,CAR0C,CAU1C;;AACA,QAAMC,MAAM,GAAGd,aAAa,CAACe,OAAO,CAACC,GAAR,CAAYC,eAAb,CAA5B;;AAEA,MAAI;AACH,UAAMH,MAAM,CAACI,OAAP,CAAeC,MAAf,CAAsB;AAC3BX,MAAAA,MAD2B;AAE3BI,MAAAA,MAF2B;AAG3BC,MAAAA,WAH2B;AAI3BO,MAAAA,QAAQ,EAAE;AAJiB,KAAtB,CAAN;AAMA,WAAOlB,OAAO,CAAC;AAAEmB,MAAAA,MAAM,EAAE;AAAV,KAAD,CAAd;AACC,GARF,CASA,OAAOC,CAAP,EAAU;AACT,WAAOnB,OAAO,CAAC;AAAEoB,MAAAA,OAAO,EAAED,CAAC,CAACC;AAAb,KAAD,CAAd;AACC;AACF","sourcesContent":["import stripePackage from \"stripe\";\nimport { calculateCost } from \"./libs/billing-lib\";\nimport { success, failure } from \"./libs/response-lib\";\n\nexport async function main(event, context) {\n\t\n\t/*The storage variable is the number of notes the user would like to store\n\tin his account. And source is the Stripe token for the card that we \n\tare going to charge.*/\n\n\tconst { storage, source } = JSON.parse(event.body);\n\tconst amount = calculateCost(storage);\n\tconst description = \"Scratch charge\";\n\n\t// Load our secret key from the environment variables\n\tconst stripe = stripePackage(process.env.stripeSecretKey);\n\n\ttry {\n\t\tawait stripe.charges.create({\n\t\t\tsource,\n\t\t\tamount,\n\t\t\tdescription,\n\t\t\tcurrency: \"usd\"\n\t\t\t});\n\t\treturn success({ status: true });\n\t\t} \n\tcatch (e) {\n\t\treturn failure({ message: e.message });\n\t\t}\n}"]},"metadata":{},"sourceType":"module"}